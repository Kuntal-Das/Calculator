name: "Deploy Calcualtor"

on:
  push:
    tags:
      - "Calc-v*"

env:
   PROJECT_PATH: dotnet restore Calculator/Calculator/Calculator.csproj

jobs:
  deploy:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2

      - name : dotnet Set-Up
        uses: actions/setup-dotnet@v1
        with:
            dotnet-version: 5.0
            
      - run: dotnet restore ${{ env.PROJECT_PATH }}

      - run: dotnet build ${{ env.PROJECT_PATH }} -c Release --no-restore

      - run: dotnet publish ${{ env.PROJECT_PATH }} -c Release --self-contained -r win-x64 -p:PublishSingleFile=true --no-build --no-restore

      - name: Create Release
        uses: actions/create-release@v1
        id: create_release
        env:
            GITHUB_TOKEN: ${{ env.GITHUB_TOKEN }}
        with:
            tag_name: ${{ github.ref }}
            release_name: ${{ github.ref }}

      # - uses: csexton/release-asset-action@v2
      #   with:
      #       github-token: ${{ env.GITHUB_TOKEN }}
      #       pattern: /Calculator/Calculator/bin/Release/net5.0-windows/win-x64/publish/*.exe
      #       release-url: ${{ steps.create_release.outputs.upload_url }}

      - name: Upload Release Asset Action
        # You may pin to the exact commit or the version.
        # uses: shogo82148/actions-upload-release-asset@8dbaa4469aa7256e70624d72f2567fac8f5341b3
        uses: shogo82148/actions-upload-release-asset@v1.6.2
        with:
          # The API token for GitHub
          github_token: ${{ env.GITHUB_TOKEN }}# default is ${{ github.token }}
          # The URL for uploading assets to the release
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          # The path to the asset you want to upload
          asset_path: /Calculator/Calculator/bin/Release/net5.0-windows/win-x64/publish/*.exe
          # The name of the asset you want to upload
          # asset_name: # optional
          # # The content-type of the asset you want to upload. See the supported Media Types here: https://www.iana.org/assignments/media-types/media-types.xhtml for more information
          # asset_content_type: # optional
          # # If an asset with the same name already exists, overwrite it (Default: false)
          # overwrite: # optional